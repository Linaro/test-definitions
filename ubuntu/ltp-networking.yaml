metadata:
    name: ltp
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "Run LTP networktests on Ubuntu."

install:
    steps:
        - 'echo "nameserver 8.8.8.8" >> /etc/resolf.conf'
        - 'ntpdate pool.ntp.org'
        - 'wget http://sourceforge.net/projects/ltp/files/LTP%20Source/ltp-20130904/ltp-full-20130904.tar.xz'
        - 'tar --strip-components=1 -Jxf ltp-full-20130904.tar.xz'
        - 'wget http://people.linaro.org/~vincent.hsu/ltp-networking-patch.tgz'
        - 'tar -zxf ltp-networking-patch.tgz'
        - 'for i in ./*.patch; do patch -p1 < $i; done'
        - './configure'
        - 'make all'
        - 'make SKIP_IDCHECK=1 install'
    deps:
        - bzip2
        - flex
        - bison
        - build-essential
        - wget
        - autoconf
        - automake
        - autotools-dev
        - m4
        - libaio-dev
        - libattr1-dev
        - libcap-dev
        - libtirpc-dev
        - linux-headers-3.10.0-1-linaro-arndale
        - python-minimal
        - traceroute
        - rwho
        - rdist
        - rstat-client
        - rstatd
        - rusers
        - rusersd
        - ftp
        - finger
        - fingerd
        - dmucs
        - nfs-common
        - bind9-host
        - iptables
        - telnet
        - tcpdump
        - psmisc
        - xinetd

run:
    steps:
        - "./ubuntu/scripts/ltp-networking.sh"

parse:
    pattern: "^test_case_id:(?P<test_case_id>.+)\\s+result:(?P<result>\\w+)"
    fixupdict:
        TPASS: pass
        TFAIL: fail
        TBROK: fail
