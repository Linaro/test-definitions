metadata:
    name: kvm-arm64-guest-on-arm64-host
    format: "Manual Test Definition 1.0"
    description: "Test kvm running on arm64 bit guest on arm64 bit host"
    maintainer:
        - naresh.kamboju@linaro.org
    os:
        - ubuntu
        - openembedded
    scope:
        - functional
    devices:
        - hi6220-hikey
    environment:
        - manual-test

install:
    deps:
        - qemu-system-arm
        - qemu-efi
        - wget
run:
    steps:
        - Boot arm64 bit board
        - After boot success check for "ls /dev/kvm" kvm device entry
        - If /dev/kvm not found, mark test case as not applicable and exit
        - Else continue below steps for installation of required packages
        - Run "sudo apt update"
        - Run "sudo apt install wget qemu-system-arm qemu-efi"
        - Execute the following command to download arm64 minimal rootfs
        - "wget http://builds.96boards.org/snapshots/developer-cloud/debian/cloud-image/12/debian-cloud-image.qcow2"
        - Run "qemu-system-aarch64 -smp 2 -m 512 -cpu host -machine type=virt,gic-version=host -bios /usr/share/qemu-efi/QEMU_EFI.fd -device virtio-blk-device,drive=image -drive if=none,id=image,file=debian-cloud-image.qcow2 -netdev user,id=user0 -device virtio-net-device,netdev=user0 -nographic -enable-kvm 2>&1 | tee tee kvm-arm64.log"
        - Wait for couple of minutes let the qemu start booting guest kernel

    expected:
        - qemu should start booting the given guest kernel
        - qeme guest kernel boot should be successful
        - Run "uname -a" to check system information
