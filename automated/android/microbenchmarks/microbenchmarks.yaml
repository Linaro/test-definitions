metadata:
    name: microbenchmarks
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "Run ART microbenchmarks."
    maintainer:
        - vishal.bhoj@linaro.org
    os:
        - android
    devices:
        - pixel
        - nexus5x
    scope:
        - performance
    environment:
        - lava-test-shell
        - local-test-runner

params:
    SNAPSHOTS_URL: ""
    SOURCE_PROJECT_NAME: ""
    SOURCE_BUILD_NUMBER: ""
    SOURCE_BUILD_URL: ""
    ART_TOKEN: ""
    ART_URL: ""
    LUNCH_TARGET: ""
    BUILD_TARBALL: ""
    ITERATIONS: "10"
    MODE: ""
    # Specify url and token for file uploading.
    URL: "https://archive.validation.linaro.org/artifacts/team/qa/"
    TOKEN: "4373c97b474497dbd12373689d7d492e"

run:
    steps:
        - export SECRETS_FILE=${PWD}/../../../secrets
        - cd ./automated/android/microbenchmarks
        - . ./microbenchmarks.sh -s true
        - cd workspace/pbr/artifacts
        - ARTIFACTS=$(ls)
        - ../../../../../utils/upload-to-artifactorial.sh -a "${ATTACHMENT}" -u "${URL}" -t "${TOKEN}"
