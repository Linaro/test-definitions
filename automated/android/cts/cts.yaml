metadata:
    name: cts
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "Run CTS on Linaro android."
    maintainer:
        - milosz.wasilewski@linaro.org
        - chase.qi@linaro.org
    os:
        - debian
        - ubuntu
    devices:
        - lxc
    scope:
        - functional

params:
    SKIP_INSTALL: "false"
    # Specify timeout in seconds for wait_boot_completed and wait_homescreen.
    TIMEOUT: "300"
    # Specify adb device SN if more then one device connected.
    SN: ""
    JDK: "openjdk-8-jdk-headless"
    # Download CTS package or copy it from local disk.
    # CTS_URL: "/root/android-cts/linaro/7.1_r1/android-cts-7.1_r1.zip"
    CTS_URL: "http://testdata.validation.linaro.org/cts/android-cts-7.1_r1.zip"
    TEST_PARAMS: "run cts -m CtsBionicTestCases --abi arm64-v8a --disable-reboot --skip-preconditions --skip-device-info"
    # Specify url and token for file uploading.
    URL: "https://archive.validation.linaro.org/artifacts/team/qa/"
    TOKEN: "4373c97b474497dbd12373689d7d492e"
run:
    steps:
        - cd ./automated/android/cts
        - ./cts.sh -s "${SKIP_INSTALL}" -o "${TIMEOUT}" -n "${SN}" -d "${JDK}" -c "${CTS_URL}" -t "${TEST_PARAMS}"
        # Upload test log and result files to artifactorial.
        - cp -r ./android-cts/results ./output/ || true
        - cp -r ./android-cts/logs ./output/ || true
        - tar caf cts-output-$(date +%Y%m%d%H%M%S).tar.xz ./output
        - ATTACHMENT=$(ls cts-output-*.tar.xz)
        - ../../utils/upload-to-artifactorial.sh -a "${ATTACHMENT}" -u "${URL}" -t "${TOKEN}"
        # Send test result to LAVA.
        - ../../utils/send-to-lava.sh ./output/result.txt
