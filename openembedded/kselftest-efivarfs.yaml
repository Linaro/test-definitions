metadata:
    name: kselftest-efivarfs
    format: "Lava-Test-Shell Test Definition 1.0"
    description:
        "These test code were came from kernel source KERNEL_SRC/tools/testing/selftests/
         For running this test, git is required in the rootfs"
    maintainer:
        - arthur.she@linaro.org
    os:
        - openembedded
    devices:
        - arndale
        - beaglebone-black
        - rtsm_fvp_base-aemv8a
    scope:
        - functional

install:
    git-repos:
        - http://git.linaro.org/qa/kselftest.git
    steps:
        - 'cd kselftest'
        - 'git checkout $BRANCH'
        - 'make -C efivarfs'

params:
    BRANCH: master

run:
    steps:
        - 'cd kselftest/efivarfs'
        - 'LOG="efivarfs.log"; (/bin/bash efivarfs.sh 2>&1 || echo "efivarfs: [FAIL]") | tee ../../${LOG}'
        - 'cd ../.. ; [ -n "`grep \"skip\" ${LOG}`" ] && echo "efivarfs: [SKIP]" >> ${LOG}'
        - 'echo "cat ${LOG}"; cat ${LOG}'
        - './openembedded/scripts/kselftest-parser.sh ${LOG}'

parse:
    pattern: "^(?P<test_case_id>[a-z_-]+):\\s\\[(?P<result>PASS|FAIL|SKIP)\\]"
    fixupdict:
        FAIL: fail
        PASS: pass
        SKIP: skip

