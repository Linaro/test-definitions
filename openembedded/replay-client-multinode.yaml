metadata:
    format: Lava-Test Test Definition 1.0
    name: tcpreplay-client-multinode
    description: "Basic MultiNode tcpreplay test on client side"
    maintainer:
        - weilong.chen@linaro.org
    os:
        - ubuntu
    scope:
        - functional
        - performance
        - latency
        - cpu utilization
    devices:
        - kvm
        - arndale
        - panda
        - beaglebone-black
        - beagle-xm
        - mx53loco

install:
     deps:
         - flex
         - bison
         - python-minimal
         - build-essential
run:
    steps:
        - wget http://www.tcpdump.org/release/libpcap-1.5.2.tar.gz
        - tar -zxf libpcap-1.5.2.tar.gz
        - cd libpcap-1.5.2/
        - sh configure
        - make
        - make install
        - cd ..
        - wget http://prdownloads.sourceforge.net/tcpreplay/tcpreplay-3.4.4.tar.gz
        - tar -zxf tcpreplay-3.4.4.tar.gz
        - cd tcpreplay-3.4.4
        - sh configure
        - make
        - make install
        - cd ..
        - lava-sync start
        - ifconfig -a
        - route
        - lava-network broadcast eth0
        - lava-network collect eth0
        - cat /tmp/lava_multi_node_network_cache.txt
        - ls -l /tmp
        - line=`lava-group | grep server | awk '{print $1}'`
        - STR=`lava-network query $line ipv4`
        - remote_ip=`echo $STR | sed -e 's/.*addr://'`
        - lava-test-case multinode-lava-network --shell ./common/scripts/generator.sh eth0 $remote_ip max 100
        - lava-sync done 

parse:
        "pattern": "^test_case_id:(?P<test_case_id>.+) units:(?P<units>.+) measurement:(?P<measurement>\\d+\\.\\d+) result:(?P<result>\\w+)"
